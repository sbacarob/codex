defmodule Codex.Author do
  @moduledoc """
  contains functions to access Goodreads' API endpoints related to authors
  """

  alias Codex.HttpClient

  @doc """
  Paginate an author's books. Calls Goodreads' `/author/list.xml` endpoint.

  ## Args:

  * `author_id` - The Goodreads id of the author.
  * `page` - (optional) the number of the page of results to retrieve. Defaults to `1`.

  ## Examples:

      iex> Codex.Author.paginate_books(84825, 1)
      {:ok, "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<GoodreadsResponse>\n  <Request>\n    <authentication>true</authentication>\n      <key><![CDATA[YOUR_API_KEY]]></key>\n    <method><![CDATA[author_list]]></method>\n  </Request>\n  <author>\n  <id>84825</id>\n  <name>Jorge Franco</name>\n  <link><![CDATA[https://www.goodreads.com/author/show/84825.Jorge_Franco]]></link>\n  <books start=\"1\" end=\"23\" total=\"23\">\n    <book>\n  <id type=\"integer\">171327</id>\n  <isbn>1583226125</isbn>\n  <isbn13>9781583226124</isbn13>\n  <text_reviews_count type=\"integer\">123</text_reviews_count>\n  <uri>kca://book/amzn1.gr.book.v1.ngRyFV31gzi2cERCSkT7mA</uri>\n  <title>Rosario Tijeras</title>\n  <title_without_series>Rosario Tijeras</title_without_series>\n  <image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320484864l/171327._SX98_.jpg</image_url>\n  <small_image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320484864l/171327._SX50_.jpg</small_image_url>\n  <large_image_url/>\n  <link>https://www.goodreads.com/book/show/171327.Rosario_Tijeras</link>\n  <num_pages>176</num_pages>\n  <format>Paperback</format>\n  <edition_information/>\n  <publisher>Siete Cuentos</publisher>\n  <publication_day>6</publication_day>\n  <publication_year>2004</publication_year>\n  <publication_month>1</publication_month>\n  <average_rating>3.87</average_rating>\n  <ratings_count>2122</ratings_count>\n  <description>\"Como a Rosario le pegaron un tiro a quemarropa mientras le daban un beso, confundió el dolor del amor con el de la muerte\". Rosario Tijeras es el violento y violado personaje al centro de este estudio de contrastes ambientado en la Medellín autodestructiva de los años '80. Su mismo nombre -simbólico y contradictorio a la vez- sugiere el conflicto que vive como mujer que se 'convierte' al sicariato para aislarse de la violencia aterradora de las calles. Desde los pasillos del hospital donde Rosario está luchando por su vida, Antonio, el narrador, espera saber si sobrevivirá. A través de él reconstruimos la amistad entre los dos, su historia de amor con Emilio y su vida como sicaria.&lt;br /&gt;Rosario Tijeras es una obra que pertenece al estudio socio-realista Latinoamericano. Es una obra cuya prosa se revela en toda su vitalidad y vena poética.</description>\n<authors>\n<author>\n<id>84825</id>\n<name>Jorge Franco</name>\n<role></role>\n<image_url nophoto='false'>\n<![CDATA[https://images.gr-assets.com/authors/1541629332p5/84825.jpg]]>\n</image_url>\n<small_image_url nophoto='false'>\n<![CDATA[https://images.gr-assets.com/authors/1541629332p2/84825.jpg]]>\n</small_image_url>\n<link><![CDATA[https://www.goodreads.com/author/show/84825.Jorge_Franco]]></link>\n<average_rating>3.79</average_rating>\n<ratings_count>4201</ratings_count>\n<text_reviews_count>424</text_reviews_count>\n</author>\n</authors>\n  <published>2004</published>\n<work>  <id>165444</id>\n  <uri>kca://work/amzn1.gr.work.v1.CjNnS5EDorvc9wRF-TOerA</uri>\n</work></book>\n\n    <book>\n  <id type=\"integer\">21562844</id>\n  <isbn>1622639405</isbn>\n  <isbn13>9781622639403</isbn13>\n  <text_reviews_count type=\"integer\">129</text_reviews_count>\n  <uri>kca://book/amzn1.gr.book.v1.jinMskCOdtFRCXp8WlrrYA</uri>\n  <title>El mundo de afuera</title>\n  <title_without_series>El mundo de afuera</title_without_series>\n  <image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1398035667l/21562844._SY160_.jpg</image_url>\n  <small_image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1398035667l/21562844._SY75_.jpg</small_image_url>\n  <large_image_url/>\n  <link>https://www.goodreads.com/book/show/21562844-el-mundo-de-afuera</link>\n  <num_pages>303</num_pages>\n  <format>Paperback</format>\n  <edition_information/>\n  <publisher>Alfaguara</publisher>\n  <publication_day>1</publication_day>\n  <publication_year>2014</publication_year>\n  <publication_month>9</publication_month>\n  <average_rating>3.62</average_rating>\n  <ratings_count>1002</ratings_count>\n  <description>&lt;i&gt;El mundo de afuera&lt;/i&gt; transcurre en Medellín. Allí, el tiempo viene envuelto " <> ...}

      iex> Codex.Author.paginate_books(84825)
      {:ok, "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<GoodreadsResponse>\n  <Request>\n    <authentication>true</authentication>\n      <key><![CDATA[YOUR_API_KEY]]></key>\n    <method><![CDATA[author_list]]></method>\n  </Request>\n  <author>\n  <id>84825</id>\n  <name>Jorge Franco</name>\n  <link><![CDATA[https://www.goodreads.com/author/show/84825.Jorge_Franco]]></link>\n  <books start=\"1\" end=\"23\" total=\"23\">\n    <book>\n  <id type=\"integer\">171327</id>\n  <isbn>1583226125</isbn>\n  <isbn13>9781583226124</isbn13>\n  <text_reviews_count type=\"integer\">123</text_reviews_count>\n  <uri>kca://book/amzn1.gr.book.v1.ngRyFV31gzi2cERCSkT7mA</uri>\n  <title>Rosario Tijeras</title>\n  <title_without_series>Rosario Tijeras</title_without_series>\n  <image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320484864l/171327._SX98_.jpg</image_url>\n  <small_image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320484864l/171327._SX50_.jpg</small_image_url>\n  <large_image_url/>\n  <link>https://www.goodreads.com/book/show/171327.Rosario_Tijeras</link>\n  <num_pages>176</num_pages>\n  <format>Paperback</format>\n  <edition_information/>\n  <publisher>Siete Cuentos</publisher>\n  <publication_day>6</publication_day>\n  <publication_year>2004</publication_year>\n  <publication_month>1</publication_month>\n  <average_rating>3.87</average_rating>\n  <ratings_count>2122</ratings_count>\n  <description>\"Como a Rosario le pegaron un tiro a quemarropa mientras le daban un beso, confundió el dolor del amor con el de la muerte\". Rosario Tijeras es el violento y violado personaje al centro de este estudio de contrastes ambientado en la Medellín autodestructiva de los años '80. Su mismo nombre -simbólico y contradictorio a la vez- sugiere el conflicto que vive como mujer que se 'convierte' al sicariato para aislarse de la violencia aterradora de las calles. Desde los pasillos del hospital donde Rosario está luchando por su vida, Antonio, el narrador, espera saber si sobrevivirá. A través de él reconstruimos la amistad entre los dos, su historia de amor con Emilio y su vida como sicaria.&lt;br /&gt;Rosario Tijeras es una obra que pertenece al estudio socio-realista Latinoamericano. Es una obra cuya prosa se revela en toda su vitalidad y vena poética.</description>\n<authors>\n<author>\n<id>84825</id>\n<name>Jorge Franco</name>\n<role></role>\n<image_url nophoto='false'>\n<![CDATA[https://images.gr-assets.com/authors/1541629332p5/84825.jpg]]>\n</image_url>\n<small_image_url nophoto='false'>\n<![CDATA[https://images.gr-assets.com/authors/1541629332p2/84825.jpg]]>\n</small_image_url>\n<link><![CDATA[https://www.goodreads.com/author/show/84825.Jorge_Franco]]></link>\n<average_rating>3.79</average_rating>\n<ratings_count>4201</ratings_count>\n<text_reviews_count>424</text_reviews_count>\n</author>\n</authors>\n  <published>2004</published>\n<work>  <id>165444</id>\n  <uri>kca://work/amzn1.gr.work.v1.CjNnS5EDorvc9wRF-TOerA</uri>\n</work></book>\n\n    <book>\n  <id type=\"integer\">21562844</id>\n  <isbn>1622639405</isbn>\n  <isbn13>9781622639403</isbn13>\n  <text_reviews_count type=\"integer\">129</text_reviews_count>\n  <uri>kca://book/amzn1.gr.book.v1.jinMskCOdtFRCXp8WlrrYA</uri>\n  <title>El mundo de afuera</title>\n  <title_without_series>El mundo de afuera</title_without_series>\n  <image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1398035667l/21562844._SY160_.jpg</image_url>\n  <small_image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1398035667l/21562844._SY75_.jpg</small_image_url>\n  <large_image_url/>\n  <link>https://www.goodreads.com/book/show/21562844-el-mundo-de-afuera</link>\n  <num_pages>303</num_pages>\n  <format>Paperback</format>\n  <edition_information/>\n  <publisher>Alfaguara</publisher>\n  <publication_day>1</publication_day>\n  <publication_year>2014</publication_year>\n  <publication_month>9</publication_month>\n  <average_rating>3.62</average_rating>\n  <ratings_count>1002</ratings_count>\n  <description>&lt;i&gt;El mundo de afuera&lt;/i&gt; transcurre en Medellín. Allí, el tiempo viene envuelto " <> ...}
  """
  def paginate_books(author_id, page \\ 1) do
    endpoint = "author/list.xml"

    HttpClient.get(endpoint, [], params: %{"id" => author_id, "page" => page})
  end

  @doc """
  Get info about an author given their Goodreads id.

  ## Args:

  * `author_id` - The Goodreads id of the author

  ## Examples:

      iex> Codex.Author.info_by_id(84825)
      {:ok, "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<GoodreadsResponse>\n  <Request>\n    <authentication>true</authentication>\n      <key><![CDATA[YOUR_API_KEY]]></key>\n    <method><![CDATA[author_show]]></method>\n  </Request>\n  <author>\n  <id>84825</id>\n  <name>Jorge Franco</name>\n  <link><![CDATA[https://www.goodreads.com/author/show/84825.Jorge_Franco]]></link>\n  <fans_count type=\"integer\">132</fans_count>\n  <author_followers_count type=\"integer\">132</author_followers_count>\n  <large_image_url><![CDATA[https://images.gr-assets.com/authors/1541629332p7/84825.jpg]]></large_image_url>\n  <image_url><![CDATA[https://images.gr-assets.com/authors/1541629332p5/84825.jpg]]></image_url>\n  <small_image_url><![CDATA[https://images.gr-assets.com/authors/1541629332p2/84825.jpg]]></small_image_url>\n  <about><![CDATA[Jorge Franco, born in Colombia, studied Film Direction at the London Film School and Literature at the Pontificia Universidad Javeriana. MALDITO AMOR was his first book of short stories and MALA NOCHE his first novel, both of which received prestigious national awards.<br />ROSARIO TIJERAS, published in 1999, has enjoyed spectacular commercial success in Colombia and marked the breakthrough of one of the most promising writers of new Latin American narrative. It is the story of the love triangle between outlaw Rosario and two young men from Colombian high society. Terrorism, violence and narco-trafficking provide a fascinating background to the fast-paced plot. It has recently been made into a major feature film, taking the Colombian box-office by storm with more than 1.000.000 movie-goers flocking to the big-screen within only two weeks of opening. PARAÍSO TRAVEL (2002) solidly reaffirmed Jorge Franco’s reputation with the tale of a young Colombian couple who attempt to escape the widespread violence of their country of origin by fleeing to New York as illegal immigrants. MELODRAMA (2006) is yet another contemporary story of “Colombians abroad” in Paris. He made an important comeback with the novel EL MUNDO DE AFUERA, winner the Premio Alfaguara 2014. His last book EL CIELO A TIROS, published in September 2018, became a #1 best selling title in it's first week in bookstores. Gabriel García Márquez has said about Jorge Franco: “This is one of the Colombian authors I would like to pass the torch to”.<br />Web site <a target=\"_blank\" href=\"http://www.jorge-franco.com\" rel=\"nofollow\">www.jorge-franco.com</a><br />]]></about>\n  <influences></influences>\n  <works_count>23</works_count>\n  <gender></gender>\n  <hometown>Medellín</hometown>\n  <born_at></born_at>\n  <died_at></died_at>\n  <goodreads_author>true</goodreads_author>\n    <user>\n  <id type=\"integer\">85885375</id>\n</user>\n\n\n    <books>\n      <book>\n  <id type=\"integer\">171327</id>\n  <isbn>1583226125</isbn>\n  <isbn13>9781583226124</isbn13>\n  <text_reviews_count type=\"integer\">123</text_reviews_count>\n  <uri>kca://book/amzn1.gr.book.v1.ngRyFV31gzi2cERCSkT7mA</uri>\n  <title>Rosario Tijeras</title>\n  <title_without_series>Rosario Tijeras</title_without_series>\n  <image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320484864l/171327._SX98_.jpg</image_url>\n  <small_image_url>https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320484864l/171327._SX50_.jpg</small_image_url>\n  <large_image_url/>\n  <link>https://www.goodreads.com/book/show/171327.Rosario_Tijeras</link>\n  <num_pages>176</num_pages>\n  <format>Paperback</format>\n  <edition_information/>\n  <publisher>Siete Cuentos</publisher>\n  <publication_day>6</publication_day>\n  <publication_year>2004</publication_year>\n  <publication_month>1</publication_month>\n  <average_rating>3.87</average_rating>\n  <ratings_count>2122</ratings_count>\n  <description>\"Como a Rosario le pegaron un tiro a quemarropa mientras le daban un beso, confundió el dolor del amor con el de la muerte\". Rosario Tijeras es el violento y violado personaje al centro de este estudio de contrastes ambientado en la Medellín autodestructiva de los años '80. Su mismo nombre -simbólico y contradictorio a la vez- sugiere el c" <> ...}
  """
  def info_by_id(author_id) do
    endpoint = "author/show.xml"

    HttpClient.get(endpoint, [], params: %{"id" => author_id})
  end

  @doc """
  Find an author's Goodreads info given the author's name.

  ## Args:

  * `name` - The name of the author to search for.

  ## Examples:

      iex> Codex.Author.find_by_name("Jorge Franco")
      {:ok, "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<GoodreadsResponse>\n  <Request>\n    <authentication>true</authentication>\n      <key><![CDATA[YOUR_API_KEY]]></key>\n    <method><![CDATA[api_author_link]]></method>\n  </Request>\n  \n\n\t\t<author id=\"84825\">\n\t\t\t<name><![CDATA[Jorge Franco]]></name>\n\t\t\t<link>https://www.goodreads.com/author/show/84825.Jorge_Franco?utm_medium=api&amp;utm_source=author_link</link>\n\t\t</author>\n\t\n\t\n\n</GoodreadsResponse>"}
  """
  def find_by_name(name), do: HttpClient.get("api/author_url/#{name}")

  @doc """
  Get a list of an author's series.

  ## Args:

  * `author_id` - The Goodreads id of the author

  ## Examples:

      iex> Codex.Author.list_series(1077326)
      {:ok, "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<GoodreadsResponse>\n  <Request>\n    <authentication>true</authentication>\n      <key><![CDATA[YOUR_API_KEY]]></key>\n    <method><![CDATA[series_list]]></method>\n  </Request>\n  <series_works>\n<series_work>\n<id>1232928</id>\n<user_position>1</user_position>\n<series>\n<id>234280</id>\n<title>\n<![CDATA[\n    Fantastic Beasts: The Original Screenplay\n]]>\n</title>\n<description>\n<![CDATA[\n]]>\n</description>\n<note>\n<![CDATA[\n]]>\n</note>\n<series_works_count>3</series_works_count>\n<primary_work_count>3</primary_work_count>\n<numbered>true</numbered>\n</series>\n\n<work>\n<id>50435175</id>\n<uri>kca://work/amzn1.gr.work.v1.ZmCTsnX3vM_RdvrhOmOqqQ</uri>\n<best_book>\n<id>29363501</id>\n<title>Fantastic Beasts and Where to Find Them: The Original Screenplay (Fantastic Beasts: The Original Screenplay, #1)</title>\n<author>\n<id>1077326</id>\n<name>J.K. Rowling</name>\n</author>\n<image_url><![CDATA[https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1481542648l/29363501._SX98_.jpg]]></image_url>\n</best_book>\n<books_count>84</books_count>\n<original_publication_day>18</original_publication_day>\n<original_publication_month>11</original_publication_month>\n<original_publication_year>2016</original_publication_year>\n<original_title>Fantastic Beasts and Where to Find Them: The Original Screenplay</original_title>\n<ratings_count>108975</ratings_count>\n<ratings_sum>465112</ratings_sum>\n<reviews_count>277066</reviews_count>\n<text_reviews_count>7352</text_reviews_count>\n<average_rating></average_rating>\n</work>\n\n</series_work>\n<series_work>\n<id>1128815</id>\n<user_position></user_position>\n<series>\n<id>217773</id>\n<title>\n<![CDATA[\n    Harry Potter: A History of Magic Exhibition\n]]>\n</title>\n<description>\n<![CDATA[\n    British Library companions to the <i>Harry Potter: A History of Magic</i> exhibition held in London during 2017.\n]]>\n</description>\n<note>\n<![CDATA[\n]]>\n</note>\n<series_works_count>2</series_works_count>\n<primary_work_count>2</primary_work_count>\n<numbered>false</numbered>\n</series>\n\n<work>\n<id>57209294</id>\n<uri>kca://work/amzn1.gr.work.v1.bj3m1A5Rxkzf-dbiLrI3-A</uri>\n<best_book>\n<id>35613533</id>\n<title>Harry Potter: A History of Magic</title>\n<author>\n<id>208338</id>\n<name>British Library</name>\n</author>\n<image_url><![CDATA[https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1500670913l/35613533._SX98_.jpg]]></image_url>\n</best_book>\n<books_count>14</books_count>\n<original_publication_day>20</original_publication_day>\n<original_publication_month>10</original_publication_month>\n<original_publication_year>2017</original_publication_year>\n<original_title>Harry Potter: A History of Magic</original_title>\n<ratings_count>11024</ratings_count>\n<ratings_sum>46518</ratings_sum>\n<reviews_count>36322</reviews_count>\n<text_reviews_count>590</text_reviews_count>\n<average_rating></average_rating>\n</work>\n\n</series_work>\n<series_work>\n<id>966943</id>\n<user_position>1A</user_position>\n<series>\n<id>189486</id>\n<title>\n<![CDATA[\n    Harry Potter Korean Split-Volume Paperback\n]]>\n</title>\n<description>\n<![CDATA[\n    In South Korea, <i>Harry Potter</i> is split into <b>a different number of volumes</b> for hardbacks. The first 4 <i>Harry Potter</i> books are NOT split for the Korean hardback edition, whereas books 5-7 are all split into 2 volumes per book.\n]]>\n</description>\n<note>\n<![CDATA[\n    partial books are 1A, 1B, etc., NOT 1.1, 1.2\n]]>\n</note>\n<series_works_count>23</series_works_count>\n<primary_work_count>23</primary_work_count>\n<numbered>true</numbered>\n</series>\n\n<work>\n<id>19126692</id>\n<uri>kca://work/amzn1.gr.work.v1.Ggs3dojlMyYqmcW1X48Shg</uri>\n<best_book>\n<id>49812</id>\n<title>해리 포터와 마법사의 돌 1 (Harry Potter #1, part 1 of 2)</title>\n<author>\n<id>1077326</id>\n<name>J.K. Rowling</name>\n</author>\n<image_url><![CDATA[https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473814446l/49812._SX98_.jpg]]></image_url>\n</best_book>\n<books_count>3</books_count>\n<original_publication_day>1</original_publication_day>\n<original_publication_month>1</original_publicati" <> ...}

  """
  def list_series(author_id) do
    endpoint = "series/list"

    HttpClient.get(endpoint, [], params: %{"format" => "xml", "id" => author_id})
  end
end
